import React, { useState, useEffect } from 'react';
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import { AuthProvider } from '../context/AuthContext';
import LoginPage from '../pages/LoginPage';
import DashboardPage from '../pages/DashboardPage';
import DoctorsPage from '../pages/DoctorsPage';
import AppointmentsPage from '../pages/AppointmentsPage';
import NotificationsPage from '../pages/NotificationsPage';
import './App.css';

function App() {
  const [isAuthenticated, setIsAuthenticated] = useState<boolean>(false);
  const [loading, setLoading] = useState<boolean>(true);

  useEffect(() => {
    // Check authentication status from localStorage or token
    const token = localStorage.getItem('token');
    if (token) {
      setIsAuthenticated(true);
    }
    setLoading(false);
  }, []);

  if (loading) {
    return <div className="loading">Loading HDuce...</div>;
  }

  return (
    <AuthProvider>
      <Router>
        <div className="app">
          <Routes>
            {/* Public route - Login */}
            <Route 
              path="/login" 
              element={
                !isAuthenticated ? 
                <LoginPage setIsAuthenticated={setIsAuthenticated} /> : 
                <Navigate to="/dashboard" />
              } 
            />
            
            {/* Protected routes */}
            <Route 
              path="/dashboard" 
              element={
                isAuthenticated ? 
                <DashboardPage setIsAuthenticated={setIsAuthenticated} /> : 
                <Navigate to="/login" />
              } 
            />
            
            <Route 
              path="/doctors" 
              element={
                isAuthenticated ? 
                <DoctorsPage /> : 
                <Navigate to="/login" />
              } 
            />
            
            <Route 
              path="/appointments" 
              element={
                isAuthenticated ? 
                <AppointmentsPage /> : 
                <Navigate to="/login" />
              } 
            />
            
            <Route 
              path="/notifications" 
              element={
                isAuthenticated ? 
                <NotificationsPage /> : 
                <Navigate to="/login" />
              } 
            />
            
            {/* Default redirect */}
            <Route 
              path="/" 
              element={
                <Navigate to={isAuthenticated ? "/dashboard" : "/login"} />
              } 
            />
            
            {/* Fallback route */}
            <Route path="*" element={<div>404 - Page Not Found</div>} />
          </Routes>
        </div>
      </Router>
    </AuthProvider>
  );
}

export default App;
