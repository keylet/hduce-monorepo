worker_processes 1;

events {
    worker_connections 1024;
}

http {
    server {
        listen 80;
        server_name localhost;

        # Home page
        location = / {
            return 200 "HDUCE Healthcare API Gateway\n\nAvailable services:\n? Auth:         POST /auth/login\n? Appointments: GET  /appointments/doctors\n? Health:       GET  /health/[service]\n\nDirect access:\n? Auth:      http://localhost:8000\n? Users:     http://localhost:8001\n? Appointments: http://localhost:8002\n? Notifications: http://localhost:8003\n";
            add_header Content-Type text/plain;
        }

        # Auth service - REDIRECCIONES ESPEC?FICAS
        location /auth/login {
            proxy_pass http://auth-service:8000/login;
            proxy_set_header Host $host;
            proxy_set_header Content-Type "application/x-www-form-urlencoded";
        }

        location /auth/register {
            proxy_pass http://auth-service:8000/auth/register;
            proxy_set_header Host $host;
        }

        location /auth/ {
            proxy_pass http://auth-service:8000/;
            proxy_set_header Host $host;
        }

        # User service
        location /users/ {
            proxy_pass http://user-service:8001/;
            proxy_set_header Host $host;
        }

        # Appointment service
        location /appointments/doctors {
            proxy_pass http://appointment-service:8002/appointments/doctors;
            proxy_set_header Host $host;
        }

        location /appointments/specialties {
            proxy_pass http://appointment-service:8002/appointments/specialties;
            proxy_set_header Host $host;
        }

        location /appointments/health {
            proxy_pass http://appointment-service:8002/health;
            proxy_set_header Host $host;
        }

        location /appointments/ {
            proxy_pass http://appointment-service:8002/appointments/;
            proxy_set_header Host $host;
        }

        # Notification service
        location /notifications/ {
            proxy_pass http://notification-service:8003/;
            proxy_set_header Host $host;
        }

        # Health checks
        location /health/auth {
            proxy_pass http://auth-service:8000/health;
            proxy_set_header Host $host;
        }

        location /health/users {
            proxy_pass http://user-service:8001/health;
            proxy_set_header Host $host;
        }

        location /health/appointments {
            proxy_pass http://appointment-service:8002/health;
            proxy_set_header Host $host;
        }

        location /health/notifications {
            proxy_pass http://notification-service:8003/health;
            proxy_set_header Host $host;
        }
    }
}